{% extends "base.html" %}

{% block title %}{{ test.name }}{% endblock %}

{% block content %}
<h1>{{ test.name }}</h1>

<div class="competition-details">
    <p class="description">{{ test.description }}</p>
    <div class="meta-info">
        <p><strong>Start Date:</strong> {{ test.start_date }}</p>
        <p><strong>End Date:</strong> {{ test.end_date }}</p>
        <p><strong>Evaluation Metric:</strong> {{ test.metric }}</p>
    </div>
</div>

{% if session.username and not session.is_admin %}
<div class="submission-section">
    <h2>Submit Your Prediction</h2>
    <form method="POST" action="{{ url_for('submit_prediction', test_id=test.id) }}" enctype="multipart/form-data">
        <div class="form-group">
            <label for="prediction_file">Upload Prediction CSV (with headers):</label>
            <input type="file" id="prediction_file" name="prediction_file" accept=".csv" required>
            <small>CSV format: id,prediction (with column headers)</small>
        </div>
        <button type="submit" class="btn">Submit</button>
    </form>
</div>
{% elif not session.username %}
<div class="alert">
    <p>Please <a href="{{ url_for('login') }}">login</a> to submit your predictions.</p>
</div>
{% endif %}

<div class="submissions-section">
    <h2>Your Submissions</h2>
    {% if submissions %}
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Filename</th>
                        <th>Score</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sub in submissions %}
                        {% if sub.username == session.username %}
                        <tr>
                            <td>{{ sub.timestamp }}</td>
                            <td>{{ sub.filename }}</td>
                            <td>{{ "%.4f"|format(sub.score) }}</td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>No submissions yet.</p>
    {% endif %}
</div>

<div class="actions">
    {% if session.is_admin %}
        <a href="{{ url_for('leaderboard', test_id=test.id) }}" class="btn btn-secondary">View Leaderboard</a>
    {% endif %}
    <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to Tests</a>
</div>
{% endblock %}
