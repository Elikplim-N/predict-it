{% extends "base.html" %}

{% block title %}Student Dashboard{% endblock %}

{% block content %}
<div class="nav">
    <div class="nav-left">
        <h1>🎓 Student Dashboard</h1>
        <span style="color: #666;">Welcome, <strong>{{ student_index }}</strong></span>
    </div>
    <div>
        <a href="javascript:location.reload()" class="btn btn-primary" style="margin-right: 10px;">🔄 Refresh</a>
        <a href="{{ url_for('logout') }}" class="btn btn-secondary">Logout</a>
    </div>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div class="stats">
    <div class="stat-card">
        <div class="stat-value">{{ submissions|length }}</div>
        <div class="stat-label">📤 Your Submissions</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ "%.6f"|format(best_score) if best_score else "—" }}</div>
        <div class="stat-label">🏆 Your Best RMSE</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ submissions[-1][1]|round(6) if submissions else "—" }}</div>
        <div class="stat-label">📊 Latest Submission</div>
    </div>
</div>

<div class="card">
    <h2 style="margin-top: 0;">📤 Upload Your Predictions</h2>
    <p style="color: #666; margin-bottom: 20px;">
        Upload your CSV file with predictions from your ML model. Format: CSV with 'id' and 'prediction' columns.
    </p>
    
    <form method="POST" action="{{ url_for('upload_prediction') }}" enctype="multipart/form-data" id="uploadForm">
        <div class="form-group">
            <label for="file">📁 Select CSV File</label>
            <input type="file" id="file" name="file" accept=".csv" required onchange="updateFileName(this)">
            <small id="fileName" style="color: #999; display: block; margin-top: 5px;"></small>
        </div>
        <button type="submit" class="btn btn-primary" id="submitBtn">⚡ Upload & Calculate RMSE</button>
    </form>
</div>

<script>
function updateFileName(input) {
    const fileName = document.getElementById('fileName');
    if (input.files && input.files[0]) {
        fileName.textContent = '✓ ' + input.files[0].name + ' (' + (input.files[0].size / 1024).toFixed(2) + ' KB)';
    }
}

document.getElementById('uploadForm').addEventListener('submit', function() {
    document.getElementById('submitBtn').disabled = true;
    document.getElementById('submitBtn').textContent = '⏳ Uploading...';
});
</script>

<h2>Submission History</h2>
{% if submissions %}
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Filename</th>
                <th>RMSE</th>
                <th>Submission Date</th>
            </tr>
        </thead>
        <tbody>
            {% for submission in submissions %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ submission[0] }}</td>
                <td><strong>{{ "%.6f"|format(submission[1]) }}</strong></td>
                <td>{{ submission[2] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p style="color: #666; text-align: center; padding: 40px;">
        No submissions yet. Upload your first prediction above!
    </p>
{% endif %}
{% endblock %}
